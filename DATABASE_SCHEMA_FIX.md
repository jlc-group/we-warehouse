# üîß Database Schema Fix

## ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö

Error: `column "unit" does not exist`

‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á `inventory_items` ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå `unit` ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î SQL

## Schema ‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á inventory_items

‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå `/src/integrations/supabase/types.ts`:

```typescript
inventory_items: {
  Row: {
    box_quantity: number
    created_at: string
    id: string
    location: string
    loose_quantity: number
    lot: string | null
    mfd: string | null
    product_name: string
    sku: string
    updated_at: string
    user_id: string | null
  }
}
```

**‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå `unit`!**

## ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

### 1. ‡πÉ‡∏ä‡πâ `product_name` ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏´‡∏ô‡πà‡∏ß‡∏¢

‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå `unit` ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏Å‡∏≥‡∏´‡∏ô‡∏î:

```sql
-- ‡πÄ‡∏î‡∏¥‡∏° (‡∏ú‡∏¥‡∏î)
CASE WHEN unit = '‡∏•‡∏±‡∏á' THEN ...

-- ‡πÉ‡∏´‡∏°‡πà (‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á)
CASE WHEN LOWER(product_name) LIKE '%‡∏•‡∏±‡∏á%' OR LOWER(product_name) LIKE '%carton%' THEN ...
```

### 2. ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô `sku_code` ‡πÄ‡∏õ‡πá‡∏ô `sku`

‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå `sku` ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà `sku_code`

### 3. ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤

```sql
CASE
    WHEN LOWER(product_name) LIKE '%‡∏•‡∏±‡∏á%' OR LOWER(product_name) LIKE '%carton%' THEN '‡∏•‡∏±‡∏á'
    WHEN LOWER(product_name) LIKE '%‡∏ä‡∏¥‡πâ‡∏ô%' OR LOWER(product_name) LIKE '%piece%' OR LOWER(product_name) LIKE '%pcs%' THEN '‡∏ä‡∏¥‡πâ‡∏ô'
    ELSE '‡∏Å‡∏•‡πà‡∏≠‡∏á'
END
```

## ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡πÉ‡∏ô complete_database_setup.sql

### ‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:
```sql
SUM(CASE WHEN unit = '‡∏•‡∏±‡∏á' THEN ... END) as total_cartons,
'sku_code', sku_code,
'unit', COALESCE(unit, '‡∏Å‡∏•‡πà‡∏≠‡∏á'),
```

### ‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:
```sql
SUM(CASE WHEN LOWER(product_name) LIKE '%‡∏•‡∏±‡∏á%' THEN ... END) as total_cartons,
'sku_code', sku,
'unit', CASE WHEN LOWER(product_name) LIKE '%‡∏•‡∏±‡∏á%' THEN '‡∏•‡∏±‡∏á' ... END,
```

## ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡πÅ‡∏ô‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢

### ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏à‡∏±‡∏î‡πÄ‡∏õ‡πá‡∏ô "‡∏•‡∏±‡∏á":
- "‡∏ú‡∏á‡∏ã‡∏±‡∏Å‡∏ü‡∏≠‡∏Å ABC 1 ‡∏•‡∏±‡∏á"
- "Soap Carton Pack"
- "‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏•‡∏±‡∏á 24 ‡∏Ç‡∏ß‡∏î"

### ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏à‡∏±‡∏î‡πÄ‡∏õ‡πá‡∏ô "‡∏ä‡∏¥‡πâ‡∏ô":
- "‡∏™‡∏ö‡∏π‡πà‡∏Å‡πâ‡∏≠‡∏ô 1 ‡∏ä‡∏¥‡πâ‡∏ô"
- "‡πÅ‡∏õ‡∏£‡∏á‡∏ü‡∏±‡∏ô 1 piece"
- "‡∏Ç‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô 5 pcs"

### ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏∑‡πà‡∏ô‡πÜ:
- ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏à‡∏±‡∏î‡πÄ‡∏õ‡πá‡∏ô "‡∏Å‡∏•‡πà‡∏≠‡∏á" (default)

## ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö

‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏£‡∏±‡∏ô SQL script ‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß:

```sql
-- ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡πÅ‡∏ô‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢
SELECT
    product_name,
    CASE
        WHEN LOWER(product_name) LIKE '%‡∏•‡∏±‡∏á%' OR LOWER(product_name) LIKE '%carton%' THEN '‡∏•‡∏±‡∏á'
        WHEN LOWER(product_name) LIKE '%‡∏ä‡∏¥‡πâ‡∏ô%' OR LOWER(product_name) LIKE '%piece%' OR LOWER(product_name) LIKE '%pcs%' THEN '‡∏ä‡∏¥‡πâ‡∏ô'
        ELSE '‡∏Å‡∏•‡πà‡∏≠‡∏á'
    END as detected_unit
FROM inventory_items
LIMIT 10;
```

## ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏

- ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏´‡∏ô‡πà‡∏ß‡∏¢ ‡∏ã‡∏∂‡πà‡∏á‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ 100%
- ‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå `unit` ‡∏à‡∏£‡∏¥‡∏á‡πÜ ‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á
- ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà error